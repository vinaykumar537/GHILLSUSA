!function(e,t,i,n,o,a){var s=n.createElement,r=e.BlockControls,l=a.withState,d=o.Toolbar,c=o.IconButton,u=o.Spinner,p=i.__;t.registerBlockType("siteorigin-panels/layout-block",{title:p("SiteOrigin Layout","siteorigin-panels"),description:p("Build a layout using SiteOrigin's Page Builder.","siteorigin-panels"),icon:function(){return s("span",{className:"siteorigin-panels-block-icon"})},category:"layout",keywords:["page builder","column,grid","panel"],supports:{html:!1},attributes:{panelsData:{type:"object"}},edit:l({editing:"edit"===soPanelsBlockEditorAdmin.defaultMode,panelsInitialized:!1,loadingPreview:!1,previewInitialized:!1,previewHtml:""})(function(l){if(l.editing||!l.attributes.panelsData)return[s(r,{key:"controls"},s(d,null,s(c,{className:"components-icon-button components-toolbar__control",label:p("Preview layout.","siteorigin-panels"),onClick:function(){l.attributes.panelsData&&l.setState({editing:!1,previewInitialized:!1})},icon:"visibility"}))),s("div",{key:"pageBuilder",className:"siteorigin-panels-layout-block-container",ref:function(e){if(!l.panelsInitialized){var t=jQuery(e),i=new panels.model.builder,n=new panels.view.builder({model:i,config:{editorType:"standalone"}}),o=JSON.parse(JSON.stringify($.extend({},l.attributes.panelsData)));function a(){l.toggleSelection(!1),$(document).on("mouseup",function e(){l.toggleSelection(!0),$(document).off("mouseup",e)})}n.on("row_added",function(){n.$(".so-row-move").off("mousedown",a),n.$(".so-row-move").on("mousedown",a),n.$(".so-widget").off("mousedown",a),n.$(".so-widget").on("mousedown",a)}),n.on("widget_added",function(){n.$(".so-widget").off("mousedown",a),n.$(".so-widget").on("mousedown",a)}),n.render().attach({container:t}).setData(o),n.trigger("builder_resize"),n.on("content_change",function(){l.setAttributes({panelsData:n.getData()}),l.setState({previewInitialized:!1,previewHtml:""})}),$(document).trigger("panels_setup",n),l.setState({editing:!0,panelsInitialized:!0})}}})];var e=!l.editing&&!l.previewHtml&&l.attributes.panelsData;e&&$.post({url:soPanelsBlockEditorAdmin.previewUrl,data:{action:"so_panels_block_editor_preview",panelsData:JSON.stringify(l.attributes.panelsData)}}).then(function(e){l.setState({previewHtml:e,loadingPreview:!1})});var t=l.previewHtml?l.previewHtml:"";return[s(r,{key:"controls"},s(d,null,s(c,{className:"components-icon-button components-toolbar__control",label:p("Edit layout.","siteorigin-panels"),onClick:function(){l.setState({editing:!0,panelsInitialized:!1})},icon:"edit"}))),s("div",{key:"preview",className:"so-panels-block-layout-preview-container"},e?s("div",{className:"so-panels-spinner-container"},s("span",null,s(u))):s("div",{dangerouslySetInnerHTML:{__html:t},ref:function(){l.editing||l.previewInitialized||($(document).trigger("panels_setup_preview"),l.setState({previewInitialized:!0}))}}))]}),save:function(){return null}})}(window.wp.editor,window.wp.blocks,window.wp.i18n,window.wp.element,window.wp.components,window.wp.compose),function(t){t(function(){setTimeout(function(){var e=t("#siteorigin-panels-add-layout-block-button").html();t(e).insertAfter(".editor-writing-flow > div:first").on("click",function(){var e=wp.blocks.createBlock("siteorigin-panels/layout-block",{});wp.data.dispatch("core/editor").insertBlock(e)})},100)})}(jQuery);